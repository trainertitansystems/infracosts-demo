#!/usr/bin/env bash
set -euo pipefail

MODULE_PATH=$1
PR_NUMBER=$2
ROOT_DIR=$(pwd)

TOTAL=$(cat "$ROOT_DIR/.total_cost")
ANALYSIS=$(cat "$ROOT_DIR/.gemini_output")

echo "ðŸ“ Posting comment to PR #$PR_NUMBER..."

cat > comment.md <<EOF
## ðŸ’° FinOps Gate: \`$MODULE_PATH\`

| Metric | Value |
|:-------|:------|
| **Direct Monthly Cost** | **\$$TOTAL** |
| **Status** | $( (( $(echo "$TOTAL > 0" | bc -l) )) && echo "ðŸ’¸ Billable" || echo "ðŸ‘» Potential Shadow Costs" ) |

---

### ðŸ§  Gemini Architect Analysis
$ANALYSIS

---
*Generated by Terraform FinOps Pipeline*
EOF

gh pr comment "$PR_NUMBER" --body-file comment.md
